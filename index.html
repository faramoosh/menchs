<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ù†Ú† | Ø¨Ø§Ø²ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(145deg, #1e3c4f, #2b5c6f);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 8px;
        }

        .game-container {
            max-width: 480px;
            width: 100%;
            background: #2a4e5e;
            border-radius: 40px;
            padding: 16px;
            border: 3px solid #ffd966;
            box-shadow: 0 20px 30px rgba(0,0,0,0.5);
        }

        h1 {
            text-align: center;
            color: #ffd966;
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-shadow: 3px 3px 0 #b4652a;
        }

        /* Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù† */
        .selector {
            background: #213743;
            padding: 15px;
            border-radius: 30px;
            margin-bottom: 15px;
            border: 2px solid #5f9db2;
        }

        .selector label {
            display: block;
            text-align: center;
            color: #ffd966;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        .player-btns {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .player-btn {
            flex: 1;
            background: #3a5a6b;
            border: none;
            color: white;
            padding: 12px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border: 2px solid #7fa9b8;
            cursor: pointer;
        }

        .player-btn.active {
            background: #52b9d1;
            border-color: #ffd966;
            transform: scale(1.02);
        }

        .start-btn {
            width: 100%;
            background: #ffb347;
            border: none;
            color: #1e2f3a;
            padding: 14px;
            border-radius: 40px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 #a8651e;
            transition: 0.1s;
        }

        .start-btn:active {
            transform: translateY(5px);
            box-shadow: none;
        }

        /* ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ */
        .status {
            background: #213743;
            padding: 12px;
            border-radius: 30px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #5f9db2;
        }

        .turn {
            background: #52b9d1;
            padding: 8px 20px;
            border-radius: 40px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            border: 2px solid #ffd966;
        }

        .dice-show {
            background: #3a5a6b;
            padding: 8px 20px;
            border-radius: 40px;
            font-size: 1.3rem;
            color: white;
            border: 2px solid #ffb347;
        }

        /* ===== ØµÙØ­Ù‡ Ù…Ù†Ú† Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ ===== */
        .board {
            background: #ecd8b4;
            border-radius: 30px;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(11, 1fr);
            gap: 5px;
            aspect-ratio: 1/1;
            width: 100%;
            border: 4px solid #aa8e6c;
            margin-bottom: 15px;
        }

        .cell {
            aspect-ratio: 1/1;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            position: relative;
            box-shadow: 0 3px 0 #8b6f4c;
        }

        /* Ù…Ø³ÛŒØ± Ø§ØµÙ„ÛŒ - 40 Ø®Ø§Ù†Ù‡ */
        .path-red { background: #ff9999; }
        .path-blue { background: #9999ff; }
        .path-green { background: #99cc99; }
        .path-yellow { background: #ffff99; }

        /* Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø±ÙˆØ¹ */
        .home-red { background: #ff4444; border: 2px solid white; }
        .home-blue { background: #4444ff; border: 2px solid white; }
        .home-green { background: #44aa44; border: 2px solid white; }
        .home-yellow { background: #ffdd44; border: 2px solid white; }

        /* Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ */
        .finish-red { background: #ff8888; border: 3px solid #cc0000; }
        .finish-blue { background: #8888ff; border: 3px solid #0000cc; }
        .finish-green { background: #88cc88; border: 3px solid #008800; }
        .finish-yellow { background: #ffee88; border: 3px solid #aa8800; }

        /* Ø®Ø§Ù†Ù‡ Ø§Ù…Ù† */
        .safe {
            border: 4px solid gold;
            box-shadow: 0 0 15px gold;
        }

        /* Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ */
        .piece {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            margin: 1px;
            font-size: 0.8rem;
            box-shadow: 0 3px 0 rgba(0,0,0,0.3);
            border: 2px solid white;
        }

        .red-piece { background: #cc0000; }
        .blue-piece { background: #0000cc; }
        .green-piece { background: #008800; }
        .yellow-piece { background: #aa8800; }

        /* Ú©Ù†ØªØ±Ù„ */
        .controls {
            display: flex;
            gap: 10px;
            background: #1d3e4b;
            padding: 12px;
            border-radius: 60px;
            border: 3px solid #ffb347;
            margin-bottom: 8px;
        }

        .dice-box {
            background: white;
            border-radius: 20px;
            padding: 5px 20px;
            box-shadow: inset 0 -4px 0 #aaa;
        }

        .dice {
            font-size: 3rem;
            min-width: 80px;
            text-align: center;
        }

        .roll-btn {
            flex: 1;
            background: #52b9d1;
            border: none;
            color: white;
            font-size: 1.4rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 0 #217a94;
            border: 2px solid #b5e4f0;
        }

        .roll-btn:active {
            transform: translateY(6px);
            box-shadow: none;
        }

        .message {
            background: #152d36;
            color: #cbe7f1;
            padding: 12px;
            border-radius: 40px;
            text-align: center;
            font-size: 1rem;
            border: 2px solid #ffb347;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ğŸ² Ù…Ù†Ú† ğŸ²</h1>

        <!-- Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø§Ø²ÛŒÚ©Ù† -->
        <div class="selector" id="selector">
            <label>ğŸ‘¥ ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†:</label>
            <div class="player-btns">
                <button class="player-btn active" data-count="2">Û² Ù†ÙØ±</button>
                <button class="player-btn" data-count="3">Û³ Ù†ÙØ±</button>
                <button class="player-btn" data-count="4">Û´ Ù†ÙØ±</button>
            </div>
            <button class="start-btn" id="startBtn">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</button>
        </div>

        <!-- ÙˆØ¶Ø¹ÛŒØª -->
        <div class="status" id="status" style="display: none;">
            <div class="turn" id="turn">ğŸ”´ Ù‚Ø±Ù…Ø²</div>
            <div class="dice-show" id="diceShow">ğŸ² -</div>
        </div>

        <!-- ØµÙØ­Ù‡ Ø¨Ø§Ø²ÛŒ -->
        <div class="board" id="board"></div>

        <!-- Ú©Ù†ØªØ±Ù„ -->
        <div class="controls">
            <div class="dice-box">
                <div class="dice" id="dice">ğŸ²</div>
            </div>
            <button class="roll-btn" id="rollBtn">Ù¾Ø±ØªØ§Ø¨</button>
        </div>

        <!-- Ù¾ÛŒØ§Ù… -->
        <div class="message" id="message">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
    </div>

    <script>
        // ==================== Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† ====================
        const players = [
            { id: 0, name: 'Ù‚Ø±Ù…Ø²', emoji: 'ğŸ”´', color: 'red', startX: 0, startY: 0 },
            { id: 1, name: 'Ø¢Ø¨ÛŒ', emoji: 'ğŸ”µ', color: 'blue', startX: 7, startY: 0 },
            { id: 2, name: 'Ø³Ø¨Ø²', emoji: 'ğŸŸ¢', color: 'green', startX: 0, startY: 7 },
            { id: 3, name: 'Ø²Ø±Ø¯', emoji: 'ğŸŸ¡', color: 'yellow', startX: 7, startY: 7 }
        ];

        // Ù…Ø³ÛŒØ± Ø­Ø±Ú©Øª (40 Ø®Ø§Ù†Ù‡)
        const path = [
            // 0-9: Ù…Ø³ÛŒØ± Ù‚Ø±Ù…Ø²
            {x:2,y:2}, {x:3,y:2}, {x:4,y:2}, {x:5,y:2}, {x:6,y:2},
            {x:7,y:2}, {x:8,y:2}, {x:8,y:3}, {x:8,y:4}, {x:8,y:5},
            // 10-19: Ù…Ø³ÛŒØ± Ø¢Ø¨ÛŒ
            {x:8,y:6}, {x:8,y:7}, {x:8,y:8}, {x:7,y:8}, {x:6,y:8},
            {x:5,y:8}, {x:4,y:8}, {x:3,y:8}, {x:2,y:8}, {x:2,y:7},
            // 20-29: Ù…Ø³ÛŒØ± Ø³Ø¨Ø²
            {x:2,y:6}, {x:2,y:5}, {x:2,y:4}, {x:2,y:3}, {x:3,y:3},
            {x:4,y:3}, {x:5,y:3}, {x:6,y:3}, {x:7,y:3}, {x:7,y:4},
            // 30-39: Ù…Ø³ÛŒØ± Ø²Ø±Ø¯
            {x:7,y:5}, {x:7,y:6}, {x:6,y:6}, {x:5,y:6}, {x:4,y:6},
            {x:3,y:6}, {x:3,y:5}, {x:3,y:4}, {x:4,y:4}, {x:5,y:4}
        ];

        // Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ù…Ù†
        const safePositions = [0, 8, 13, 21, 26, 34, 39];

        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
        let gamePlayers = [];
        let currentPlayer = 0;
        let gameActive = false;
        let moving = false;
        let extraTurn = false;

        // ==================== ØµÙØ­Ù‡ ====================
        function createBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';

            // 9x9 Ú¯Ø±ÛŒØ¯
            for (let y = 0; y < 9; y++) {
                for (let x = 0; x < 9; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;

                    // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ø®Ø§Ù†Ù‡
                    const pathIndex = path.findIndex(p => p.x === x && p.y === y);
                    
                    if (pathIndex !== -1) {
                        // Ù…Ø³ÛŒØ± Ø§ØµÙ„ÛŒ
                        if (pathIndex < 10) cell.classList.add('path-red');
                        else if (pathIndex < 20) cell.classList.add('path-blue');
                        else if (pathIndex < 30) cell.classList.add('path-green');
                        else cell.classList.add('path-yellow');

                        if (safePositions.includes(pathIndex)) {
                            cell.classList.add('safe');
                        }
                    }
                    
                    // Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ø±ÙˆØ¹
                    if ((x < 2 && y < 2)) cell.classList.add('home-red');
                    if ((x > 6 && y < 2)) cell.classList.add('home-blue');
                    if ((x < 2 && y > 6)) cell.classList.add('home-green');
                    if ((x > 6 && y > 6)) cell.classList.add('home-yellow');

                    // Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ù‡Ø§ÛŒÛŒ
                    if (x === 4 && y === 4) {
                        cell.classList.add('finish-red', 'finish-blue', 'finish-green', 'finish-yellow');
                    }

                    board.appendChild(cell);
                }
            }
        }

        // ==================== Ù†Ù…Ø§ÛŒØ´ Ù…Ù‡Ø±Ù‡â€ŒÙ‡Ø§ ====================
        function updatePieces() {
            document.querySelectorAll('.piece').forEach(p => p.remove());

            gamePlayers.forEach((player, pIndex) => {
                player.pieces.forEach((pos, pieceIndex) => {
                    let cell;
                    
                    if (pos === -1) {
                        // Ø¯Ø± Ø®Ø§Ù†Ù‡
                        const startX = [0,7,0,7][pIndex];
                        const startY = [0,0,7,7][pIndex];
                        cell = document.querySelector(`[data-x="${startX + (pieceIndex%2)}"][data-y="${startY + Math.floor(pieceIndex/2)}"]`);
                    } else if (pos < 40) {
                        // Ø¯Ø± Ù…Ø³ÛŒØ±
                        cell = document.querySelector(`[data-x="${path[pos].x}"][data-y="${path[pos].y}"]`);
                    }

                    if (cell) {
                        const piece = document.createElement('span');
                        piece.className = `piece ${player.color}-piece`;
                        piece.textContent = pieceIndex + 1;
                        cell.appendChild(piece);
                    }
                });
            });
        }

        // ==================== ØµØ¯Ø§ ====================
        function playSound(type) {
            // Ø³Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ - Ø¨Ø¯ÙˆÙ† ØµØ¯Ø§ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø®Ø·Ø§
        }

        // ==================== Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ ====================
        function startGame(count) {
            gamePlayers = [];
            for (let i = 0; i < count; i++) {
                gamePlayers.push({
                    ...players[i],
                    pieces: [-1, -1, -1, -1]
                });
            }

            currentPlayer = 0;
            gameActive = true;
            moving = false;
            extraTurn = false;

            document.getElementById('selector').style.display = 'none';
            document.getElementById('status').style.display = 'flex';
            document.getElementById('dice').textContent = 'ğŸ²';
            document.getElementById('diceShow').textContent = 'ğŸ² -';
            document.getElementById('turn').innerHTML = `${gamePlayers[0].emoji} ${gamePlayers[0].name}`;
            document.getElementById('message').textContent = `${gamePlayers[0].emoji} ØªØ§Ø³ Ø¨Ù†Ø¯Ø§Ø²`;

            updatePieces();
            document.getElementById('rollBtn').disabled = false;
        }

        // ==================== ØªØ§Ø³ ====================
        async function rollDice() {
            if (!gameActive || moving) return;

            moving = true;
            document.getElementById('rollBtn').disabled = true;

            // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ØªØ§Ø³
            const dice = document.getElementById('dice');
            for (let i = 0; i < 10; i++) {
                dice.textContent = ['âš€','âš','âš‚','âšƒ','âš„','âš…'][Math.floor(Math.random()*6)];
                await new Promise(r => setTimeout(r, 50));
            }

            const value = Math.floor(Math.random() * 6) + 1;
            dice.textContent = ['1ï¸âƒ£','2ï¸âƒ£','3ï¸âƒ£','4ï¸âƒ£','5ï¸âƒ£','6ï¸âƒ£'][value-1];
            document.getElementById('diceShow').textContent = `ğŸ² ${value}`;

            await move(value);

            moving = false;
            document.getElementById('rollBtn').disabled = false;
        }

        // ==================== Ø­Ø±Ú©Øª ====================
        async function move(value) {
            const player = gamePlayers[currentPlayer];

            // ØªØ§Ø³ 6 Ùˆ Ù…Ù‡Ø±Ù‡ Ø¯Ø± Ø®Ø§Ù†Ù‡
            if (value === 6 && player.pieces.includes(-1)) {
                const index = player.pieces.indexOf(-1);
                player.pieces[index] = 0;
                updatePieces();
                document.getElementById('message').textContent = `${player.emoji} Ù…Ù‡Ø±Ù‡ Ø¬Ø¯ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯`;
                extraTurn = true;
                return;
            }

            // Ø­Ø±Ú©Øª Ù…Ù‡Ø±Ù‡
            const activePieces = player.pieces.filter(p => p >= 0 && p < 40);
            if (activePieces.length === 0) {
                document.getElementById('message').textContent = `${player.emoji} Ù…Ù‡Ø±Ù‡â€ŒØ§ÛŒ Ù†Ø¯Ø§Ø±ÛŒ`;
                nextTurn();
                return;
            }

            const pieceIndex = player.pieces.findIndex(p => p >= 0 && p < 40);
            let newPos = player.pieces[pieceIndex] + value;

            if (newPos >= 40) {
                document.getElementById('message').textContent = `${player.emoji} Ø¨Ù‡ Ø®Ø§Ù†Ù‡ Ø¢Ø®Ø± Ø±Ø³ÛŒØ¯`;
                player.pieces[pieceIndex] = 40 + (newPos - 40);
                updatePieces();
            } else {
                // Ø­Ø±Ú©Øª ØªÚ©Ù‡â€ŒØªÚ©Ù‡
                for (let i = player.pieces[pieceIndex] + 1; i <= newPos; i++) {
                    player.pieces[pieceIndex] = i;
                    updatePieces();
                    await new Promise(r => setTimeout(r, 150));
                }
            }

            // Ø®ÙˆØ±Ø¯Ù†
            if (!safePositions.includes(newPos) && newPos < 40) {
                gamePlayers.forEach((p, idx) => {
                    if (idx !== currentPlayer) {
                        p.pieces.forEach((pos, i) => {
                            if (pos === newPos) {
                                p.pieces[i] = -1;
                                document.getElementById('message').textContent = 
                                    `${player.emoji} Ù…Ù‡Ø±Ù‡ ${p.emoji} Ø±Ùˆ Ø®ÙˆØ±Ø¯!`;
                            }
                        });
                    }
                });
            }

            // Ø¨Ø±Ø¯
            if (player.pieces.every(p => p >= 40)) {
                document.getElementById('message').textContent = `ğŸ† ${player.emoji} Ø¨Ø±Ù†Ø¯Ù‡ Ø´Ø¯! ğŸ†`;
                gameActive = false;
                return;
            }

            if (value === 6) {
                document.getElementById('message').textContent = `${player.emoji} Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªØ§Ø³ Ø¨Ù†Ø¯Ø§Ø²`;
                extraTurn = true;
            } else {
                nextTurn();
            }
        }

        // ==================== Ù†ÙˆØ¨Øª Ø¨Ø¹Ø¯ÛŒ ====================
        function nextTurn() {
            do {
                currentPlayer = (currentPlayer + 1) % gamePlayers.length;
            } while (gamePlayers[currentPlayer].pieces.every(p => p >= 40));

            document.getElementById('turn').innerHTML = `${gamePlayers[currentPlayer].emoji} ${gamePlayers[currentPlayer].name}`;
            document.getElementById('message').textContent = `${gamePlayers[currentPlayer].emoji} Ù†ÙˆØ¨Øª ØªÙˆØ¦Ù‡`;
            extraTurn = false;
        }

        // ==================== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ====================
        document.addEventListener('DOMContentLoaded', () => {
            createBoard();

            // Ø§Ù†ØªØ®Ø§Ø¨ ØªØ¹Ø¯Ø§Ø¯
            document.querySelectorAll('.player-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.player-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            // Ø´Ø±ÙˆØ¹
            document.getElementById('startBtn').addEventListener('click', () => {
                const count = parseInt(document.querySelector('.player-btn.active').dataset.count);
                startGame(count);
            });

            // ØªØ§Ø³
            document.getElementById('rollBtn').addEventListener('click', rollDice);

            // ØªØ§Ú† Ø±ÙˆÛŒ ØµÙØ­Ù‡
            document.getElementById('board').addEventListener('click', () => {
                if (gameActive && !moving) rollDice();
            });
        });
    </script>
</body>
</html>
